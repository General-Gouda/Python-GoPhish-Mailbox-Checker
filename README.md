# Gophish Mailbox Checker

Written By: Matt Marchese - https://github.com/General-Gouda

Version: 2019.06.03

## **Summary**

- This program will check a mailbox within Office 365 for the presense of emails sent from Gophish, extract the phishing URL, transform it into a reporting URL, send a simple HTTP GET to the url to mark it as reported within Gophish, then mark the email item as read, flagged complete and categorized.

## **Installation**

1. Extract files into a file folder on the host or server that will run the application.
2. Be sure Python 3 is installed on the system running the program (created and tested on v3.7.2).
    - This program has not been tested in Python 2.
3. Open a terminal, change the current working directory to where the application files are located and run `python3 -m pip install -r requirements.txt` to install required modules. On Windows run `python -m pip install -r requirements.txt` from Powershell or cmd (Be sure that Python is in your system's PATH).
4. On a Windows machine with Powershell 5.1 installed run the *New-AzureApplication.ps1* script to create an Azure AD application in your Azure AD Tenant. When prompted to input APIAppRoles be sure to include the **Mailbox.ReadWrite** app role which grants the app the ability to read and write to emails within a mailbox and the **MailboxSettings.ReadWrite** app role to read and write *Categories* within a mailbox.
    - Requires an Azure AD Tenant and administrator credentials to run this script! It will download and install the AzureAD and AzureRM modules from PowerShell Gallery for use in the script.
    - After the script is complete be sure to write down the `Client ID`, `Client Secret` and `Tenant ID` in a **_SECURE LOCATION_** as you will need them later.
5. Open the **Config.json.sample** file included in this repository and copy the contents to your clipboard. Create a new folder named **Config** at the root level and then create a new file within that new folder named **Config.json** and paste those contents into it. Modify the values with the proper information such as the client id, mailbox, and the folder to check within the mailbox.
6. Create a new file in the root directory of the application named **app_pass** (no file extension) and place the *Client Secret* that was generated by the PowerShell script into it.
7. Execute the *Start_Program.py* application by running `python3 ./Start_Program.py`, or `python .\Start_Program.py` on Windows, to begin the application.
    - The program will run within an endless `while` loop unless the "Run_Once" setting in Config.json is set to `true`. If "Run_Once" is set to `false` the program will execute indefinitely. Once the main process has completed the program will wait for the amount of time, in seconds, specified within the "Run_Interval_Timer" configuration setting in *Config.json*.

## **Container Notes**

- It is recommended that the *Config.json* file be inserted into a volume folder so that the config settings may be easily manipulated.
- It is recommended that the *Logs* folder be a volume so the log file will be available outide of the container.
- It is recommended that the *app_pass* file be inserted into a container as a Docker Secret or equivalent file directly into the file path of the program.

## **Other Notes**

- On Linux machines be sure to be mindful of capitalization of file names. Be sure to create new files exactly as specified above, otherwise the system may not recongize them.